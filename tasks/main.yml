---
- name:                      Include OS-specific variables (Debian).
  include_vars:              "{{ ansible_distribution }}-{{ ansible_distribution_version.split('.')[0] }}.yml"
  when:                      ansible_os_family == 'Debian'

- name:                      Include OS-specific variables (RedHat).
  include_vars:              "{{ ansible_distribution }}-{{ ansible_distribution_version.split('.')[0] }}.yml"
  when:                      ansible_os_family == 'RedHat'

- name:                      Install packages
  package:
    name:                    "{{ _packages }}"
    state:                   present

- name:                      Da fuckgin python {{ ansible_distribution }}
  set_fact:
     ansible_install_python: python3
  when:                      ansible_distribution  == 'Ubuntu'

- name:                      Da fuckgin python {{ ansible_distribution }}
  set_fact:
     ansible_install_python: python
  when:                      (ansible_distribution == 'Debian')or (ansible_os_family == 'RedHat')

- name:                      Download and install  pip
  block:
    - file:
        path:                /root/.cache
        state:               directory
        mode:                0700
    - get_url:
        url:                 https://bootstrap.pypa.io/get-pip.py
        dest:                /root/.cache/get-pip.py
        mode:                0600
    - command:               "{{ ansible_install_python }} get-pip.py"
      args:
        chdir:               /root/.cache
        creates:             /root/.cache/pip_install_done
      register:              get_pip_result
    # - debug:
    #     var:               get_pip_result
    - file:
        path:                /root/.cache/pip_install_done
        state:               touch
        mode:                0700
      when:                  get_pip_result.changed == true
  become:                    true
  become_user:               root
